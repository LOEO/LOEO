<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leo.dao.MenuDao">
    <insert id="insert">
        insert into t_sys_menu (name,iconCls,link,pid,isLeaf,orde,createDt,createUser,updateDt,updateUser,enable)
        values (#{name},#{iconCls},#{link},#{pid},#{isLeaf},#{orde},#{createDt},#{createUser},#{updateDt},#{updateUser},#{enable})
    </insert>
    <update id="update">
        update t_sys_menu set
        <if test="name != null">
            name=#{name},
        </if>
        <if test="iconCls != null">
            iconCls=#{iconCls},
        </if>
        <if test="link != null">
            link=#{link},
        </if>
        <if test="pid != null">
            pid=#{pid},
        </if>
        <if test="isLeaf!=null">
            isLeaf=#{isLeaf},
        </if>
        <if test="orde!=null">
            orde=#{orde},
        </if>
        <if test="createDt!=null">
            createDt=#{createDt},
        </if>
        <if test="createUser!=null">
            createUser=#{createUser},
        </if>
        <if test="updateDt!=null">
            updateDt=#{updateDt},
        </if>
        <if test="updateUser!=null">
            updateUser=#{updateUser},
        </if>
        <if test="enable!=null">
            enable=#{enable},
        </if>
        id=id
        <where>
            id=#{id}
        </where>
    </update>

    <delete id="deleteById">
        delete from t_sys_menu
        <where>id=#{id}</where>
    </delete>

    <select id="list" resultType="SysMenu">
        select * from t_sys_menu
        <where>
            <if test="_parameter != null">
                pid=#{_parameter}
            </if>
        </where>
        order by pid,orde
    </select>

    <select id="getById" resultType="SysMenu">
        select * from t_sys_menu where id=#{id}
    </select>
    <select id="getUserMenuList" resultType="com.leo.entity.SysMenu">
        select * from t_sys_menu where id in (SELECT
            DISTINCT m.id
        FROM
            t_sys_menu m,
            t_sys_privilege p,
            t_sys_role r,
            t_sys_user u,
            t_sys_user_role ur
        WHERE
            u.id = ur.userId
        AND r.id = ur.roleId
        AND ((p.`master` = 'role'
        AND p.masterValue = r.id) or (p.`master`='user' and p.masterValue=u.id))
        AND p.access = 'menu'
        AND p.accessValue=m.id
        AND u.id = #{userId}) order by orde;
    </select>


</mapper>